static void __io_free_req(struct io_kiocb *req)
{
	struct io_uring_task *tctx;
	struct io_ring_ctx *ctx;

	io_dismantle_req(req);
	tctx = req->task->io_uring;
	ctx = req->ctx;

	atomic_long_inc(&tctx->req_complete);
	if (tctx->in_idle)
		wake_up(&tctx->wait);
	put_task_struct(req->task);

	if (likely(!io_is_fallback_req(req)))
		kmem_cache_free(req_cachep, req);
	else
		clear_bit_unlock(0, (unsigned long *) &ctx->fallback_req);
	percpu_ref_put(&ctx->refs);
}