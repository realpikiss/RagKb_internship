static void
xirc2ps_detach(struct pcmcia_device *link)
{
    struct net_device *dev = link->priv;
    struct local_info *local = netdev_priv(dev);

    netif_carrier_off(dev);
    netif_tx_disable(dev);
    cancel_work_sync(&local->tx_timeout_task);

    dev_dbg(&link->dev, "detach\n");

    unregister_netdev(dev);

    xirc2ps_release(link);

    free_netdev(dev);
} /* xirc2ps_detach */